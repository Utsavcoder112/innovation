<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>FoodLinker - Request Food</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
        }
        
        /* Request Modal Styles */
        .request-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .request-modal-content {
            background-color: #fff;
            border-radius: 8px;
            max-width: 600px;
            margin: 30px auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideDown 0.3s ease-out;
            overflow: hidden;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .request-modal-header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .request-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .close-request-modal {
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .close-request-modal:hover {
            color: #e0e0e0;
        }
        
        .request-modal-body {
            padding: 20px;
        }
        
        .donation-summary {
            background-color: #f5f5f5;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .donation-summary h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #555;
        }
        
        .summary-item {
            display: flex;
            margin-bottom: 8px;
        }
        
        .summary-label {
            width: 120px;
            font-weight: 500;
            color: #666;
        }
        
        .summary-value {
            flex: 1;
        }
        
        .request-form-group {
            margin-bottom: 20px;
        }
        
        .request-form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #555;
        }
        
        .request-form-group input,
        .request-form-group select,
        .request-form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .request-form-group input:focus,
        .request-form-group select:focus,
        .request-form-group textarea:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
        }
        
        .request-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-error {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .request-modal-footer {
            padding: 15px 20px;
            background-color: #f9f9f9;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .cancel-btn, .submit-request-btn {
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .cancel-btn {
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            color: #666;
        }
        
        .submit-request-btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .submit-request-btn i {
            font-size: 14px;
        }
        
        .cancel-btn:hover {
            background-color: #e5e5e5;
        }
        
        .submit-request-btn:hover {
            background-color: #43a047;
        }
        
        .cancel-btn:active, .submit-request-btn:active {
            transform: translateY(1px);
        }
        
        /* Success Message */
        .success-message {
            display: none;
            text-align: center;
            padding: 30px 20px;
        }
        
        .success-icon {
            background-color: #4CAF50;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 24px;
        }
        
        .success-message h3 {
            font-size: 1.25rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .success-message p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .request-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            display: none;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Requests Dashboard Styles */
        .requests-container {
            display: none; /* Hidden by default, will be shown in the dashboard */
            padding: 20px;
        }
        
        .requests-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .requests-header h1 {
            font-size: 1.8rem;
            color: #333;
        }
        
        .request-filters {
            display: flex;
            gap: 10px;
        }
        
        .request-filter-btn {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .request-filter-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .request-filter-btn:hover:not(.active) {
            background-color: #e5e5e5;
        }
        
        .request-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .request-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .request-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .request-card-header {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .request-food-title {
            font-weight: 600;
            font-size: 1rem;
            color: #333;
        }
        
        .request-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .request-status.pending {
            background-color: #FFF3E0;
            color: #E65100;
        }
        
        .request-status.approved {
            background-color: #E8F5E9;
            color: #2E7D32;
        }
        
        .request-status.rejected {
            background-color: #FFEBEE;
            color: #C62828;
        }
        
        .request-card-body {
            padding: 15px;
        }
        
        .request-detail {
            display: flex;
            margin-bottom: 8px;
            align-items: flex-start;
        }
        
        .request-detail i {
            color: #666;
            width: 20px;
            margin-right: 8px;
            margin-top: 3px;
        }
        
        .request-detail-content {
            flex: 1;
        }
        
        .request-detail-content .label {
            font-weight: 500;
            color: #555;
            margin-bottom: 2px;
        }
        
        .request-detail-content .value {
            color: #666;
        }
        
        .request-card-footer {
            padding: 10px 15px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
        }
        
        .request-date {
            font-size: 12px;
            color: #777;
        }
        
        .request-actions {
            display: flex;
            gap: 10px;
        }
        
        .request-action-btn {
            background: none;
            border: none;
            color: #555;
            cursor: pointer;
            font-size: 14px;
            transition: color 0.2s;
        }
        
        .request-action-btn:hover {
            color: #4CAF50;
        }
        
        .no-requests {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .no-requests i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 20px;
        }
        
        .no-requests h3 {
            font-size: 1.25rem;
            color: #555;
            margin-bottom: 10px;
        }
        
        .no-requests p {
            color: #777;
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <!-- Request Modal -->
    <div id="requestModal" class="request-modal">
        <div class="request-modal-content">
            <div class="request-modal-header">
                <div class="request-modal-title">Request Food Donation</div>
                <span class="close-request-modal" onclick="closeRequestModal()">&times;</span>
            </div>
            <div id="requestFormContainer">
                <div class="request-modal-body">
                    <div class="donation-summary">
                        <h3>Donation Summary</h3>
                        <div class="summary-item">
                            <div class="summary-label">Food Item:</div>
                            <div class="summary-value" id="summaryTitle"></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Donor:</div>
                            <div class="summary-value" id="summaryDonor"></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Pickup Address:</div>
                            <div class="summary-value" id="summaryAddress"></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Pickup Date:</div>
                            <div class="summary-value" id="summaryPickupDate"></div>
                        </div>
                    </div>
                    
                    <form id="requestForm">
                        <input type="hidden" id="donationId">
                        
                        <div class="request-form-group">
                            <label for="requestorName">Your Name *</label>
                            <input type="text" id="requestorName" required>
                            <div class="form-error" id="nameError">Please enter your name</div>
                        </div>
                        
                        <div class="request-form-group">
                            <label for="organization">Organization (Optional)</label>
                            <input type="text" id="organization" placeholder="If applicable">
                        </div>
                        
                        <div class="request-form-group">
                            <label for="contactPhone">Phone Number *</label>
                            <input type="tel" id="contactPhone" required>
                            <div class="form-error" id="phoneError">Please enter a valid phone number</div>
                        </div>
                        
                        <div class="request-form-group">
                            <label for="contactEmail">Email Address *</label>
                            <input type="email" id="contactEmail" required>
                            <div class="form-error" id="emailError">Please enter a valid email address</div>
                        </div>
                        
                        <div class="request-form-group">
                            <label for="pickupTime">Preferred Pickup Time *</label>
                            <select id="pickupTime" required>
                                <option value="">Select a time</option>
                                <option value="morning">Morning (8AM - 12PM)</option>
                                <option value="afternoon">Afternoon (12PM - 4PM)</option>
                                <option value="evening">Evening (4PM - 8PM)</option>
                            </select>
                            <div class="form-error" id="pickupTimeError">Please select a pickup time</div>
                        </div>
                        
                        <div class="request-form-group">
                            <label for="requestReason">Reason for Request *</label>
                            <textarea id="requestReason" placeholder="Briefly explain why you're requesting this food donation" required></textarea>
                            <div class="form-error" id="reasonError">Please provide a reason for your request</div>
                        </div>
                        
                        <div class="request-form-group">
                            <label for="additionalNotes">Additional Notes (Optional)</label>
                            <textarea id="additionalNotes" placeholder="Any additional information the donor should know"></textarea>
                        </div>
                    </form>
                </div>
                
                <div class="request-modal-footer">
                    <button class="cancel-btn" onclick="closeRequestModal()">Cancel</button>
                    <button class="submit-request-btn" onclick="submitFoodRequest()">
                        <span class="request-spinner" id="requestSpinner"></span>
                        <i class="fas fa-paper-plane"></i> Submit Request
                    </button>
                </div>
            </div>
            
            <!-- Success Message (initially hidden) -->
            <div class="success-message" id="successMessage">
                <div class="success-icon">
                    <i class="fas fa-check"></i>
                </div>
                <h3>Request Submitted Successfully!</h3>
                <p>Your request has been sent to the donor. You will be notified once they review your request.</p>
                <button class="submit-request-btn" onclick="closeRequestModal()">
                    <i class="fas fa-check"></i> Done
                </button>
            </div>
        </div>
    </div>
    
    <!-- Template for the Requests Dashboard (will be shown in sidebar section) -->
    <div class="requests-container" id="newRequestsContainer">
        <div class="requests-header">
            <h1>New Requests</h1>
            <div class="request-filters">
                <button class="request-filter-btn active" data-filter="all">
                    <i class="fas fa-list"></i> All
                </button>
                <button class="request-filter-btn" data-filter="today">
                    <i class="fas fa-calendar-day"></i> Today
                </button>
                <button class="request-filter-btn" data-filter="week">
                    <i class="fas fa-calendar-week"></i> This Week
                </button>
            </div>
        </div>
        
        <div id="newRequestItems" class="request-items">
            <!-- Request cards will be added here dynamically -->
            <div class="no-requests" id="noNewRequests">
                <i class="fas fa-inbox"></i>
                <h3>No New Requests</h3>
                <p>You don't have any new food requests at the moment.</p>
            </div>
        </div>
    </div>
    
    <!-- Template for All Requests Dashboard (will be shown in sidebar section) -->
    <div class="requests-container" id="allRequestsContainer">
        <div class="requests-header">
            <h1>All Requests</h1>
            <div class="request-filters">
                <button class="request-filter-btn active" data-filter="all">
                    <i class="fas fa-list"></i> All
                </button>
                <button class="request-filter-btn" data-filter="pending">
                    <i class="fas fa-clock"></i> Pending
                </button>
                <button class="request-filter-btn" data-filter="approved">
                    <i class="fas fa-check-circle"></i> Approved
                </button>
                <button class="request-filter-btn" data-filter="rejected">
                    <i class="fas fa-times-circle"></i> Rejected
                </button>
            </div>
        </div>
        
        <div id="allRequestItems" class="request-items">
            <!-- Request cards will be added here dynamically -->
            <div class="no-requests" id="noAllRequests">
                <i class="fas fa-clipboard-list"></i>
                <h3>No Requests Found</h3>
                <p>You don't have any food requests in your history.</p>
            </div>
        </div>
    </div>
<script>
    // Mock data for food donations (in a real application, this would come from a database)
const foodDonations = [
    {
        id: 1,
        title: "Fresh Vegetables Assortment",
        donor: "Green Farms Market",
        address: "123 Harvest Lane, Farmville",
        pickupDate: "2025-05-18"
    },
    {
        id: 2,
        title: "Bakery Items Bundle",
        donor: "Sweet Delights Bakery",
        address: "456 Baker Street, Downtown",
        pickupDate: "2025-05-20"
    },
    {
        id: 3,
        title: "Canned Goods Collection",
        donor: "Community Food Bank",
        address: "789 Helper Road, Centertown",
        pickupDate: "2025-05-19"
    }
];

// Storage for food requests (in a real application, this would be saved to a database)
let foodRequests = [];

// Format date to a readable string
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString('en-US', options);
}

// Format relative time (today, yesterday, etc.)
function getRelativeTime(dateString) {
    const date = new Date(dateString);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    if (date.getTime() === today.getTime()) {
        return 'Today';
    } else if (date.getTime() === yesterday.getTime()) {
        return 'Yesterday';
    } else {
        return formatDate(dateString);
    }
}

// Open request modal with donation details
function openRequestModal(donationId) {
    const donation = foodDonations.find(item => item.id === donationId);
    
    if (donation) {
        // Fill in the summary section
        document.getElementById('summaryTitle').textContent = donation.title;
        document.getElementById('summaryDonor').textContent = donation.donor;
        document.getElementById('summaryAddress').textContent = donation.address;
        document.getElementById('summaryPickupDate').textContent = formatDate(donation.pickupDate);
        
        // Set the donation ID in the hidden field
        document.getElementById('donationId').value = donation.id;
        
        // Reset the form
        document.getElementById('requestForm').reset();
        
        // Hide success message and show form
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('requestFormContainer').style.display = 'block';
        
        // Show the modal
        document.getElementById('requestModal').style.display = 'block';
        
        // Reset error messages
        const errorElements = document.querySelectorAll('.form-error');
        errorElements.forEach(el => el.style.display = 'none');
    }
}

// Close request modal
function closeRequestModal() {
    document.getElementById('requestModal').style.display = 'none';
}

// Validate form fields
function validateForm() {
    let isValid = true;
    
    // Validate name
    const name = document.getElementById('requestorName').value.trim();
    if (!name) {
        document.getElementById('nameError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('nameError').style.display = 'none';
    }
    
    // Validate phone
    const phone = document.getElementById('contactPhone').value.trim();
    if (!phone || !/^[0-9+ -]{10,15}$/.test(phone)) {
        document.getElementById('phoneError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('phoneError').style.display = 'none';
    }
    
    // Validate email
    const email = document.getElementById('contactEmail').value.trim();
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('emailError').style.display = 'none';
    }
    
    // Validate pickup time
    const pickupTime = document.getElementById('pickupTime').value;
    if (!pickupTime) {
        document.getElementById('pickupTimeError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('pickupTimeError').style.display = 'none';
    }
    
    // Validate reason
    const reason = document.getElementById('requestReason').value.trim();
    if (!reason) {
        document.getElementById('reasonError').style.display = 'block';
        isValid = false;
    } else {
        document.getElementById('reasonError').style.display = 'none';
    }
    
    return isValid;
}

// Submit food request
function submitFoodRequest() {
    if (!validateForm()) {
        return;
    }
    
    // Show spinner
    const spinner = document.getElementById('requestSpinner');
    spinner.style.display = 'inline-block';
    
    // Get form data
    const donationId = parseInt(document.getElementById('donationId').value);
    const donation = foodDonations.find(item => item.id === donationId);
    
    const newRequest = {
        id: Date.now(), // Generate a unique ID using timestamp
        donationId: donationId,
        foodTitle: donation.title,
        donor: donation.donor,
        address: donation.address,
        pickupDate: donation.pickupDate,
        name: document.getElementById('requestorName').value.trim(),
        organization: document.getElementById('organization').value.trim(),
        phone: document.getElementById('contactPhone').value.trim(),
        email: document.getElementById('contactEmail').value.trim(),
        pickupTime: document.getElementById('pickupTime').value,
        reason: document.getElementById('requestReason').value.trim(),
        notes: document.getElementById('additionalNotes').value.trim(),
        status: 'pending',
        requestDate: new Date().toISOString().split('T')[0],
        isNew: true
    };
    
    // Simulate server delay (in a real app, this would be an API call)
    setTimeout(() => {
        // Add to request collection
        foodRequests.push(newRequest);
        
        // Hide spinner
        spinner.style.display = 'none';
        
        // Show success message
        document.getElementById('requestFormContainer').style.display = 'none';
        document.getElementById('successMessage').style.display = 'block';
        
        // Update request dashboards
        updateRequestDashboards();
        
        // In a real app, you would save this to a database or API
        console.log('Request submitted:', newRequest);
    }, 1500);
}

// Create a request card element
function createRequestCard(request) {
    const card = document.createElement('div');
    card.className = 'request-card';
    card.setAttribute('data-id', request.id);
    card.setAttribute('data-status', request.status);
    card.setAttribute('data-date', request.requestDate);
    
    // Calculate days ago for filter purposes
    const requestDate = new Date(request.requestDate);
    const today = new Date();
    const diffTime = Math.abs(today - requestDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    card.setAttribute('data-days', diffDays);
    
    // Status label text and class
    let statusText, statusClass;
    switch(request.status) {
        case 'pending':
            statusText = 'Pending';
            statusClass = 'pending';
            break;
        case 'approved':
            statusText = 'Approved';
            statusClass = 'approved';
            break;
        case 'rejected':
            statusText = 'Rejected';
            statusClass = 'rejected';
            break;
        default:
            statusText = 'Pending';
            statusClass = 'pending';
    }
    
    card.innerHTML = `
        <div class="request-card-header">
            <div class="request-food-title">${request.foodTitle}</div>
            <div class="request-status ${statusClass}">${statusText}</div>
        </div>
        <div class="request-card-body">
            <div class="request-detail">
                <i class="fas fa-user"></i>
                <div class="request-detail-content">
                    <div class="label">Requestor</div>
                    <div class="value">${request.name}${request.organization ? ' (' + request.organization + ')' : ''}</div>
                </div>
            </div>
            <div class="request-detail">
                <i class="fas fa-phone"></i>
                <div class="request-detail-content">
                    <div class="label">Contact</div>
                    <div class="value">${request.phone}</div>
                </div>
            </div>
            <div class="request-detail">
                <i class="fas fa-envelope"></i>
                <div class="request-detail-content">
                    <div class="label">Email</div>
                    <div class="value">${request.email}</div>
                </div>
            </div>
            <div class="request-detail">
                <i class="fas fa-clock"></i>
                <div class="request-detail-content">
                    <div class="label">Pickup Time</div>
                    <div class="value">${request.pickupTime.charAt(0).toUpperCase() + request.pickupTime.slice(1)}</div>
                </div>
            </div>
            <div class="request-detail">
                <i class="fas fa-calendar"></i>
                <div class="request-detail-content">
                    <div class="label">Pickup Date</div>
                    <div class="value">${formatDate(request.pickupDate)}</div>
                </div>
            </div>
            <div class="request-detail">
                <i class="fas fa-comment"></i>
                <div class="request-detail-content">
                    <div class="label">Reason</div>
                    <div class="value">${request.reason}</div>
                </div>
            </div>
            ${request.notes ? `
            <div class="request-detail">
                <i class="fas fa-sticky-note"></i>
                <div class="request-detail-content">
                    <div class="label">Notes</div>
                    <div class="value">${request.notes}</div>
                </div>
            </div>
            ` : ''}
        </div>
        <div class="request-card-footer">
            <div class="request-date">Requested: ${getRelativeTime(request.requestDate)}</div>
            <div class="request-actions">
                ${request.status === 'pending' ? `
                <button class="request-action-btn" onclick="updateRequestStatus(${request.id}, 'approved')">
                    <i class="fas fa-check"></i>
                </button>
                <button class="request-action-btn" onclick="updateRequestStatus(${request.id}, 'rejected')">
                    <i class="fas fa-times"></i>
                </button>
                ` : ''}
                <button class="request-action-btn" onclick="viewRequestDetails(${request.id})">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
        </div>
    `;
    
    return card;
}

// Update request dashboards
function updateRequestDashboards() {
    // Update New Requests dashboard
    const newRequestItems = document.getElementById('newRequestItems');
    const newRequestsContainer = document.getElementById('noNewRequests');
    
    // Filter new requests
    const newRequests = foodRequests.filter(request => request.isNew);
    
    // Clear current content except for the "no requests" message
    const existingNewCards = newRequestItems.querySelectorAll('.request-card');
    existingNewCards.forEach(card => card.remove());
    
    if (newRequests.length > 0) {
        newRequestsContainer.style.display = 'none';
        
        // Add request cards
        newRequests.forEach(request => {
            const card = createRequestCard(request);
            newRequestItems.appendChild(card);
        });
    } else {
        newRequestsContainer.style.display = 'flex';
    }
    
    // Update All Requests dashboard
    const allRequestItems = document.getElementById('allRequestItems');
    const noAllRequests = document.getElementById('noAllRequests');
    
    // Clear current content except for the "no requests" message
    const existingAllCards = allRequestItems.querySelectorAll('.request-card');
    existingAllCards.forEach(card => card.remove());
    
    if (foodRequests.length > 0) {
        noAllRequests.style.display = 'none';
        
        // Add request cards
        foodRequests.forEach(request => {
            const card = createRequestCard(request);
            allRequestItems.appendChild(card);
        });
    } else {
        noAllRequests.style.display = 'flex';
    }
}

// Update request status (approve/reject)
function updateRequestStatus(requestId, newStatus) {
    // Find the request
    const request = foodRequests.find(item => item.id === requestId);
    
    if (request) {
        // Update status
        request.status = newStatus;
        request.isNew = false; // No longer a new request
        
        // Update UI
        updateRequestDashboards();
        
        // In a real app, send update to API
        console.log(`Request ${requestId} status updated to ${newStatus}`);
    }
}

// View request details
function viewRequestDetails(requestId) {
    // This could open a detailed view modal
    // For now, we'll just log to console
    const request = foodRequests.find(item => item.id === requestId);
    console.log('Viewing request details:', request);
    
    // In a real application, this would open a modal with full details
    alert(`Viewing details for request ID: ${requestId}`);
}

// Filter requests based on criteria
function filterRequests(filterType, containerType) {
    const container = containerType === 'new' ? 
        document.getElementById('newRequestItems') : 
        document.getElementById('allRequestItems');
    
    const cards = container.querySelectorAll('.request-card');
    
    cards.forEach(card => {
        const status = card.getAttribute('data-status');
        const days = parseInt(card.getAttribute('data-days'));
        
        let show = false;
        
        switch(filterType) {
            case 'all':
                show = true;
                break;
            case 'today':
                show = days === 0;
                break;
            case 'week':
                show = days < 7;
                break;
            case 'pending':
            case 'approved':
            case 'rejected':
                show = status === filterType;
                break;
        }
        
        card.style.display = show ? 'block' : 'none';
    });
}

// Set up filter buttons
document.addEventListener('DOMContentLoaded', function() {
    // Set up filter buttons for new requests
    const newFilterButtons = document.querySelectorAll('#newRequestsContainer .request-filter-btn');
    newFilterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Update active state
            newFilterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Apply filter
            filterRequests(this.getAttribute('data-filter'), 'new');
        });
    });
    
    // Set up filter buttons for all requests
    const allFilterButtons = document.querySelectorAll('#allRequestsContainer .request-filter-btn');
    allFilterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Update active state
            allFilterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Apply filter
            filterRequests(this.getAttribute('data-filter'), 'all');
        });
    });
    
    // Add test data if needed
    // Uncomment the following lines to add some test data
    /*
    foodRequests = [
        {
            id: 101,
            donationId: 1,
            foodTitle: "Fresh Vegetables Assortment",
            donor: "Green Farms Market",
            address: "123 Harvest Lane, Farmville",
            pickupDate: "2025-05-18",
            name: "John Smith",
            organization: "Local Shelter",
            phone: "555-123-4567",
            email: "john@example.com",
            pickupTime: "morning",
            reason: "Need fresh produce for our community kitchen",
            notes: "Can only transport small quantities at a time",
            status: "pending",
            requestDate: "2025-05-15",
            isNew: true
        },
        {
            id: 102,
            donationId: 2,
            foodTitle: "Bakery Items Bundle",
            donor: "Sweet Delights Bakery",
            address: "456 Baker Street, Downtown", 
            pickupDate: "2025-05-20",
            name: "Sarah Johnson",
            organization: "Food for All",
            phone: "555-987-6543",
            email: "sarah@example.com",
            pickupTime: "afternoon",
            reason: "Weekly food distribution program",
            notes: "",
            status: "approved",
            requestDate: "2025-05-14",
            isNew: false
        }
    ];
    updateRequestDashboards();
    */
});

// Window event listener for close modal when clicking outside
window.addEventListener('click', function(event) {
    const modal = document.getElementById('requestModal');
    if (event.target === modal) {
        closeRequestModal();
    }
});
</script>
    <!-- <script>
        // Store all food requests
        let allRequests = [];
        let currentRequestFilter = 'all';
        
        // Add event listener to "Request" buttons
        document.addEventListener('DOMContentLoaded', function() {
            // Find all request buttons in food cards and add event listeners
            const requestButtons = document.querySelectorAll('.food-card .view-details-btn:nth-child(2)');
            requestButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const foodCard = button.closest('.food-card');
                    if (foodCard) {
                        const donationId = foodCard.dataset.id;
                        openRequestForm(donationId);
                    }
                });
            });
            
            // Initialize request filters event listeners
            initializeRequestFilters();
            
            // Load any existing requests (could be from localStorage or API)
            loadExistingRequests();
        });
        
        // Open the food request form
        function openRequestForm(donationId) {
            // Find the donation in the global allDonations array
            const donation = allDonations.find(d => d.id === donationId);
            
            if (!donation) {
                console.error('Donation not found:', donationId);
                return;
            }
            
            // Set form hidden field
            document.getElementById('donationId').value = donationId;
            
            // Fill donation summary
            document.getElementById('summaryTitle').textContent = donation.title;
            
            // Extract name from email (just a placeholder for donor name)
            const emailParts = donation.contact_email.split('@');
            const donorName = emailParts[0].charAt(0).toUpperCase() + emailParts[0].slice(1);
            document.getElementById('summaryDonor').textContent = donorName;
            
            document.getElementById('summaryAddress').textContent = donation.pickup_address;
            
            // Format pickup date
            const pickupDate = new Date(donation.pickup_date);
            document.getElementById('summaryPickupDate').textContent = pickupDate.toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
            
            // Reset form
            document.getElementById('requestForm').reset();
            document.querySelectorAll('.form-error').forEach(el => el.style.display = 'none');
            
            // Hide success message and show form
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('requestFormContainer').style.display = 'block';
            
            // Show the modal
            document.getElementById('requestModal').style.display = 'block';
        }
        
        // Close the request modal
        function closeRequestModal() {
            document.getElementById('requestModal').style.display = 'none';
        }
        
        // Validate the request form
        function validateRequestForm() {
            let isValid = true;
            
            // Validate name
            const name = document.getElementById('requestorName').value.trim();
            if (!name) {
                document.getElementById('nameError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('nameError').style.display = 'none';
            }
            
            // Validate phone
            const phone = document.getElementById('contactPhone').value.trim();
            if (!phone || !isValidPhone(phone)) {
                document.getElementById('phoneError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('phoneError').style.display = 'none';
            }
            
            // Validate email
            const email = document.getElementById('contactEmail').value.trim();
            if (!email || !isValidEmail(email)) {
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('emailError').style.display = 'none';
            }
            
            // Validate pickup time
            const pickupTime = document.getElementById('pickupTime').value;
            if (!pickupTime) {
                document.getElementById('pickupTimeError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('pickupTimeError').style.display = 'none';
            }
            
            // Validate reason
            const reason = document.getElementById('requestReason').value.trim();
            if (!reason) {
                document.getElementById('reasonError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('reasonError').style.display = 'none';
            }
            
            return isValid;
        }
        
        // Email validation helper
        function isValidEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email.toLowerCase());
        }
        
        // Phone validation helper
        function isValidPhone(phone) {
            // Basic validation - would need to be enhanced for international numbers
            const re = /^[0-9\+\-\(\)\s]{10,15}$/;
            return re.test(phone);
        }
        
        // Submit the food request
        function submitFoodRequest() {
            // Validate the form
            if (!validateRequestForm()) {
                return;
            }
            
            // Show loading spinner
            document.getElementById('requestSpinner').style.display = 'inline-block';
            
            // Get form values
            const donationId = document.getElementById('donationId').value;
            const donation = allDonations.find(d => d.id === donationId);
            
            const requestData = {
                id: 'req_' + Date.now(), // Generate a unique ID (in a real app, this would come from the server)
                donation_id: donationId,
                donation_title: donation.title,
                donation_address: donation.pickup_address,
                donation_pickup_date: donation.pickup_date,
                donation_image: donation.image_path || null,
                requestor_name: document.getElementById('requestorName').value.trim(),
                organization: document.getElementById('organization').value.trim() || null,
                contact_phone: document.getElementById('contactPhone').value.trim(),
                contact_email: document.getElementById('contactEmail').value.trim(),
                preferred_pickup_time: document.getElementById('pickupTime').value,
                request_reason: document.getElementById('requestReason').value.trim(),
                additional_notes: document.getElementById('additionalNotes').value.trim() || null,
                status: 'pending',
                created_at: new Date().toISOString()
            };
            
            // In a real application, you would send this data to the server
            // For now, we'll simulate an API call with a timeout
            setTimeout(() => {
                // Add request to our local storage
                allRequests.push(requestData);
                
                // Save to localStorage (in a real app, this would be in a database)
                saveRequests();
                
                // Update UI to show the new request in the dashboards
                updateRequestsDashboard();
                
                // Hide spinner
                document.getElementById('requestSpinner').style.display = 'none';
                
                // Show success message
                document.getElementById('requestFormContainer').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                // Notify sidebar of new request (update badge count)
                updateNotificationBadge();
            }, 1500); // Simulate 1.5 second network delay
        }
        
        // Save requests to localStorage
        function saveRequests() {
            localStorage.setItem('foodLinkerRequests', JSON.stringify(allRequests));
        }
        
        // Load existing requests from localStorage
        function loadExistingRequests() {
            const savedRequests = localStorage.getItem('foodLinkerRequests');
            if (savedRequests) {
                allRequests = JSON.parse(savedRequests);
                updateRequestsDashboard();
            }
        }
        
        // Update the requests dashboard
        function updateRequestsDashboard() {
            updateNewRequestsContainer();
            updateAllRequestsContainer();
        }
        
        // Update the New Requests container
        function updateNewRequestsContainer() {
            const container = document.getElementById('newRequestItems');
            const noRequestsEl = document.getElementById('noNewRequests');
            
            // Filter for only pending requests
            let filteredRequests = allRequests.filter(req => req.status === 'pending');
            
            // Apply additional filters
            if (currentRequestFilter === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredRequests = filteredRequests.filter(req => {
                    const createdDate = new Date(req.created_at);
                    return createdDate >= today;
                });
            } else if (currentRequestFilter === 'week') {
                const weekStart = new Date();
                weekStart.setDate(weekStart.getDate() - weekStart.getDay()); // Start of current week (Sunday)
                weekStart.setHours(0, 0, 0, 0);
                filteredRequests = filteredRequests.filter(req => {
                    const createdDate = new Date(req.created_at);
                    return createdDate >= weekStart;
                });
            }
            
            // Sort by newest first
            filteredRequests.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            // Clear container (except for the no-requests element)
            Array.from(container.children).forEach(child => {
                if (!child.classList.contains('no-requests')) {
                    container.removeChild(child);
                }
            });
            
            // Show or hide the "no requests" message
            if (filteredRequests.length === 0) {
                noRequestsEl.style.display = 'flex';
            } else {
                noRequestsEl.style.display = 'none';
                
                // Add each request card
                filteredRequests.forEach(request => {
                    const card = createRequestCard(request);
                    container.appendChild(card);
                });
            }
        }
        
        // Update the All Requests container
        function updateAllRequestsContainer() {
            const container = document.getElementById('allRequestItems');
            const noRequestsEl = document.getElementById('noAllRequests');
        } -->